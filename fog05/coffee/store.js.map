{
  "version": 3,
  "file": "store.js",
  "sourceRoot": "",
  "sources": [
    "store.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# This file contain the implementation of a proxy Store for interacting\n# with fog05. Through this API any JS-based runtime can interact with the\n# distributed store used by fog05. As such it can access the full power of\n# fog05\n\n\nroot = this\nz_ = require('./coffez.js').coffez\nWebSocket = require('ws')\n\nfog05 = {}\n\nif (typeof exports isnt 'undefined')\n  if (typeof module isnt 'undefined' and module.exports)\n    exports = module.exports = fog05\n  exports.fog05 = fog05\nelse\n  root.fog05 = fog05\n\nfog05.VERSION = \"0.1.0\"\n\n# Commands\n\nclass OK\n  constructor: (@oid, @sid, @rest) ->\n    @cid = 'OK'\n  show: () ->\n    args = @rest.reduce((a, x) -> a + \" \" + x)\n    \"#{@cid} #{@oid} #{@sid} #{@args}\"\n\nclass NOK\n  constructor: (@oid, @sid) ->\n    @cid = 'NOK'\n  show: () ->\n    \"#{@cid} #{@oid} #{@sid}\"\n\nclass Create\n  constructor: (@sid, @root, @home, @cache_size) ->\n    @cid = 'create'\n  show: () ->\n    \"#{@cid} #{@sid} #{@root} #{@home} #{@cache_size}\"\n\nclass Put\n  constructor: (@sid, @uri, @value) ->\n    @cid = 'put'\n  show: () ->\n    \"#{@cid} #{@sid} #{@uri} #{@value}\"\n\nclass Get\n  constructor: (@sid, @uri) ->\n    @cid = 'get'\n  show: () ->\n    \"#{@cid} #{@sid} #{@uri}\"\n\nclass GetAll\n  constructor: (@sid, @uri) ->\n    @cid = 'aget'\n  show: () ->\n    \"#{@cid} #{@sid} #{@uri}\"\n\nclass Observe\n  constructor: (@sid, @cookie, @uri) ->\n    @cid = 'observe'\n  show: () ->\n    \"#{@cid} #{@sid} #{@uri}\"\n\nclass Notify\n  constructor: (@sid, @cookie, @uri, @value) ->\n    @cid = 'notify'\n  show: () ->\n    \"#{@cid} #{@sid} #{@uri} #{@value}\"\n\nclass Value\n  constructor: (@sid, @key, @value) ->\n    @cid = 'value'\n  show: () ->\n    \"#{@cid} #{@sid} #{@key} #{@value}\"\n\nclass Values\n  constructor: (@sid, @key, @values) ->\n    @cid = 'values'\n  show: () ->\n    str = @values.reduce((a, v) -> a + ', ' + v)\n    \"#{@cid} #{@sid} #{@key} [#{str}]\"\n\nclass GetKeys\n  constructor: (@sid) ->\n    @cid = 'gkeys'\n  show: () ->\n    \"#{@cid} #{@sid}\"\n\nclass Keys\n  constructor: (@sid, @keys) ->\n    @cid = 'keys'\n  show: () ->\n    str= @keys.reduce((a, v) -> a + ', ' + v)\n    \"#{@cid} #{@sid} [#{str}]\"\n\nParser = {}\nParser.parseOK = (ts) ->\n  if ts.length > 2\n    z_.Some(new OK(ts[1], ts[2], ts[3..]))\n  else\n    z_.None\n\nParser.parseNOK = (ts) ->\n  if ts.length > 2\n    z_.Some(new NOK(ts[1], ts[2]))\n  else\n    z_.None\n\nParser.parseNotify = (ts) ->\n  if ts.length > 4\n    z_.Some(new Notify(ts[1], ts[2], ts[3], tr[4]))\n  else\n    z_.None\n\nParser.parseValue = (ts) ->\n  if ts.length == 3\n    z_.Some(new Value(ts[1], ts[2], z_.None))\n  else if ts.length > 3\n    z_.Some(new Value(ts[1], ts[2], z_.Some(ts[3])))\n  else\n    z_.None\n\nParser.parseValues = (ts) ->\n  if ts.length == 3\n    z_.Some(new Values(ts[1], ts[2], []))\n  else if ts.length > 3\n    xs = ts[3].split(',').map((x) -> x.split('@'))\n    z_.Some(new Values(ts[1], ts[2], xs))\n  else\n    z_.None\n\nParser.parseKeys = (ts) ->\n  if ts.length > 2\n    xs = ts[2].split(',')\n    z_.Some(new Keys(ts[1], xs))\n  else\n    z_.None\n\n\nParser.parseCmd = (cmd) ->\n  tokens = (x for x in cmd.split(' ') when x != '')\n  if tokens.length == 0\n    z_.None\n  else\n    t = tokens[0]\n    switch t\n      when 'OK'\n        Parser.parseOK(tokens)\n      when 'NOK'\n        Parser.parseNOK(tokens)\n      when 'notify'\n        Parser.parseNotify(tokens)\n      when 'value'\n        Parser.parseValue(tokens)\n      when 'values'\n        Parser.parseValues(tokens)\n      when 'keys'\n        Parser.parseKeys(tokens)\n      else\n        z_.None\n\n# The `Runtime` maintains the connection with the server, re-establish the connection if dropped and mediates\n# the `DataReader` and `DataWriter` communication.\nclass Runtime\n  # Creates a new fog05 runtime\n  constructor: (@url) ->\n    @onclose = (evt) ->\n    @onconnect = () ->\n    @ondisconnect = (evt) ->\n    @connected = false\n    @closed = true\n    @cookieId = 0\n    @pendingWebSock = z_.None\n    @webSock = z_.None\n    @storeMap = {}\n\n\n  generateCookie: () ->\n    id = @cookieId\n    @cookieId += 1\n    id\n\n  # Establish a connection with the dscript.play server\n  connect: () =>\n    if @connected is false\n      console.log(\"Connecting to: #{@url}\")\n      @pendingWebSock = z_.Some(new WebSocket(@url))\n\n      @pendingWebSock.map (\n        (s) =>\n          s.onopen = () =>\n            console.log('Connected to: ' + @url)\n            @webSock = @pendingWebSock\n            @connected = true\n            # We may need to re-establish dropped data connection, if this connection is following\n            # a disconnection.\n            @onconnect()\n      )\n\n      @pendingWebSock.map (\n        (s) => s.onclose =\n          (evt) =>\n            console.log(\"The server at #{@url} seems to have dropped the connection.\")\n            @connected = false\n            @webSock.close()\n            @closed = true\n            @webSock = z_.None\n            @ondisconnect(evt)\n      )\n\n\n      @pendingWebSock.map (\n        (s) =>\n          s.onmessage = (msg) =>\n            this.handleMessage(msg)\n      )\n    else\n      console.log(\"Warning: Trying to connect an already connected Runtime\")\n\n\n  # Disconnects, withouth closing, a `Runtime`. Notice that there is a big difference between disconnecting and\n  # closing a `Runtime`. The a disconnected `Runtime` can be reconnected and retains state across\n  # connection/disconnections. On the other hand, once closed a `Runtime` clears up all current state.\n  disconnect: () =>\n    @connected = false\n    @webSock.map(\n      (s) -> s.close()\n    )\n    @ondisconnect()\n\n\n  # Close the fog05 runtime and as a consequence all the `DataReaders` and `DataWriters` that belong to this runtime.\n  close: () =>\n    @webSock.map (\n      (s) =>\n        s.close()\n        this.onclose()\n    )\n\n  isConnected: () => @connected\n\n  isClosed: () => @closed\n\n\n  handleMessage: (s) =>\n    msg = s.data\n    cmd = Parser.parseCmd(msg)\n    smap = @storeMap\n    cmd.foreach ( (c) ->\n      z_.get(smap, c.sid).foreach( (s) ->\n        cid = c.cid\n        s.handleCommand(c))\n    )\n\n  send: (msg) ->\n    @webSock.map(\n      (s) -> s.send(msg)\n    )\n\n  register: (sid, store) ->\n    @storeMap[sid] = store\n\n\nroot.fog05.Runtime = Runtime\n\n\nclass Store\n  constructor: (@runtime, @sid, @home, @root, @cache_size) ->\n    @getTable = {}\n    @obsTable = {}\n    @keyFun = z_.None\n    @runtime.register(@sid, this)\n    cmd = new Create(@sid, @home, @root, @cache_size)\n    @runtime.send(cmd.show())\n\n  put: (key, value)  ->\n    cmd = new Put(@sid, key, value)\n    @runtime.send(cmd.show())\n\n  keys: (fun) ->\n    @keyFun = z_.Some(fun)\n    cmd = new GetKeys(@sid)\n    @runtime.send(cmd.show())\n\n  get: (key, fun) ->\n    @getTable[key] = fun\n    cmd = new Get(@sid, key)\n    @runtime.send(cmd.show())\n\n  getAll: (key, fun) ->\n    @getTable[key] = fun\n    cmd = new GetAll(@sid, key)\n    @runtime.send(cmd.show())\n\n  observe: (key, fun) ->\n    cookie = @runtime.generateCookie()\n    @obsTable[cookie] = fun\n    cmd = new Observe(@cid, cookie, key)\n    @runtime.send(cmd.show())\n\n  handleOK: (cmd) ->\n    console.log('>>> Store Handling OK')\n\n  handleNOK: (cmd) ->\n    console.log('>>> Store Handling NOK')\n\n\n  handleValue: (cmd) ->\n    console.log('>>> Store Handling Value')\n    z_.get(@getTable, cmd.key).foreach( (fun) -> fun(cmd.key, cmd.value))\n\n  handleValues: (cmd) ->\n    console.log('>>> Store Handling Values')\n    z_.get(@getTable, cmd.key).foreach( (fun) -> fun(cmd.key, cmd.values))\n\n  handleNotify: (cmd) ->\n    console.log('>>> Store Handling Notify')\n    z_.get(@obsTable, cmd.cookie).foreach( (fun) -> fun(cmd.key. cmd.value) )\n\n  handleKeys: (cmd) ->\n    @keyFun.foreach( (f) -> f(cmd.keys))\n\n  # No so elegant, but there were issues with the map of lambdas.\n  handleCommand: (cmd) ->\n    switch cmd.cid\n      when 'NOK'\n        this.handleNOK(cmd)\n      when 'OK'\n        this.handleOK(cmd)\n      when 'value'\n        this.handleValue(cmd)\n      when 'values'\n        this.handleValues(cmd)\n      when 'keys'\n        this.handleKeys(cmd)\n      when 'notify'\n        this.handleNotify(cmd)\n\n\n\n\nroot.fog05.Store = Store"
  ]
}